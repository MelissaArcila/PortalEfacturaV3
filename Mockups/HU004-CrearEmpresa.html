<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HU004 - Crear Empresa - Portal Unificado Efactura</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Roboto', Arial, sans-serif; background-color: #FAFAFA; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); padding: 40px; }
        .header h1 { font-size: 2rem; font-weight: 600; color: #212121; margin-bottom: 8px; }
        .header p { font-size: 14px; color: #757575; margin-bottom: 32px; }
        .section { margin-bottom: 40px; padding-bottom: 32px; border-bottom: 1px solid #E0E0E0; }
        .section:last-of-type { border-bottom: none; }
        .section-title { font-size: 1.25rem; font-weight: 600; color: #4A5A9E; margin-bottom: 24px; display: flex; align-items: center; gap: 8px; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .form-group { display: flex; flex-direction: column; }
        label { font-size: 14px; font-weight: 500; color: #424242; margin-bottom: 8px; }
        label.required::after { content: ' *'; color: #F44336; }
        input, select, textarea { padding: 12px; font-size: 14px; border: 1px solid #BDBDBD; border-radius: 4px; font-family: 'Roboto', Arial, sans-serif; transition: all 0.2s; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #4A5A9E; border-width: 2px; padding: 11px; }
        input:disabled, select:disabled { background-color: #F5F5F5; color: #9E9E9E; cursor: not-allowed; }
        input.error, select.error { border-color: #F44336; }
        input.success { border-color: #4CAF50; }
        .helper-text { font-size: 12px; margin-top: 4px; }
        .helper-text.error { color: #F44336; }
        .helper-text.success { color: #4CAF50; display: flex; align-items: center; gap: 4px; }
        .character-counter { font-size: 12px; color: #757575; margin-top: 4px; }
        .validation-icon { width: 20px; height: 20px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-left: 8px; }
        .validation-icon.success { background-color: #E8F5E9; color: #4CAF50; }
        .validation-icon.error { background-color: #FFEBEE; color: #F44336; }
        .btn { padding: 12px 24px; font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; border-radius: 8px; cursor: pointer; transition: all 0.3s; border: none; font-family: 'Roboto', Arial, sans-serif; }
        .btn-primary { background: linear-gradient(135deg, #4A5A9E 0%, #D4145A 100%); color: white; }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary:hover:not(:disabled) { box-shadow: 0 6px 16px rgba(74, 90, 158, 0.3); transform: translateY(-2px); }
        .btn-secondary { background: white; color: #4A5A9E; border: 1px solid #4A5A9E; }
        .btn-small { padding: 8px 16px; font-size: 13px; }
        table { width: 100%; border-collapse: collapse; margin-top: 16px; }
        th { background-color: #F5F5F5; padding: 12px; text-align: left; font-size: 13px; font-weight: 600; color: #424242; }
        td { padding: 12px; font-size: 14px; color: #616161; border-top: 1px solid #F5F5F5; }
        .icon-btn { background: transparent; border: none; cursor: pointer; padding: 4px; color: #F44336; }
        .button-group { display: flex; gap: 12px; margin-top: 32px; padding-top: 24px; border-top: 1px solid #E0E0E0; }
        @media (max-width: 768px) { .container { padding: 24px; } .form-row { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Crear Nueva Empresa</h1>
            <p>Complete el formulario con los datos de la empresa. Los campos marcados con (*) son obligatorios.</p>
        </div>

        <form id="empresaForm">
            <!-- Sección 1: Datos de la Empresa -->
            <div class="section">
                <h2 class="section-title"><span class="material-icons">business</span> Datos de la Empresa</h2>

                <div class="form-row">
                    <div class="form-group">
                        <label for="tipoId" class="required">Tipo de Identificación</label>
                        <select id="tipoId" required onchange="handleTipoIdChange()">
                            <option value="">Seleccione...</option>
                            <option value="11">Registro civil</option>
                            <option value="13">Cédula de ciudadanía</option>
                            <option value="31" selected>NIT</option>
                            <option value="41">Pasaporte</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="numeroId" class="required">Número de Identificación</label>
                        <input type="text" id="numeroId" placeholder="Solo números, máx 10 dígitos" maxlength="10" required
                            oninput="validateNumeroId()" onblur="checkUniqueness()" />
                        <div class="helper-text" id="numeroIdHelper"></div>
                    </div>
                    <div class="form-group">
                        <label for="dv">DV (Dígito de Verificación)</label>
                        <input type="text" id="dv" placeholder="0-9" maxlength="1" onblur="validateDV()" />
                        <div class="helper-text" id="dvHelper"></div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="nombreAbreviado">Nombre Abreviado</label>
                        <input type="text" id="nombreAbreviado" placeholder="Máx 50 caracteres" maxlength="50" oninput="updateCounter('nombreAbreviado', 50)" />
                        <div class="character-counter" id="nombreAbreviadoCounter">0/50 caracteres</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" id="razonSocialGroup">
                        <label for="razonSocial" class="required">Razón Social</label>
                        <input type="text" id="razonSocial" placeholder="Ingrese la razón social de la empresa" />
                    </div>
                    <div class="form-group" id="nombresGroup" style="display:none;">
                        <label for="nombres" class="required">Nombres</label>
                        <input type="text" id="nombres" placeholder="Ingrese nombres" disabled />
                    </div>
                    <div class="form-group" id="apellidosGroup" style="display:none;">
                        <label for="apellidos" class="required">Apellidos</label>
                        <input type="text" id="apellidos" placeholder="Ingrese apellidos" disabled />
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="tipoSociedad" class="required">Tipo de Sociedad</label>
                        <select id="tipoSociedad" required>
                            <option value="">Seleccione...</option>
                            <option value="4">Sociedad anónima</option>
                            <option value="10">Sociedad por acciones simplificada</option>
                            <option value="9">Sociedad limitada</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tipoContribuyente" class="required">Tipo de Contribuyente</label>
                        <select id="tipoContribuyente" required>
                            <option value="">Seleccione...</option>
                            <option value="natural">Natural</option>
                            <option value="juridico">Jurídico</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="tipoRegimen" class="required">Tipo de Régimen</label>
                        <select id="tipoRegimen" required>
                            <option value="">Seleccione...</option>
                            <option value="NA">Ninguno</option>
                            <option value="49">Simplificado (No responsable de IVA)</option>
                            <option value="48">Común (Impuesto sobre las ventas)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="correoEmisor" class="required">Correo Electrónico Emisor</label>
                        <input type="email" id="correoEmisor" placeholder="empresa@dominio.com" required onblur="validateEmail()" />
                        <div class="helper-text" id="correoHelper"></div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" style="grid-column: 1/-1;">
                        <label for="actividadEconomica">Actividad Económica (opcional)</label>
                        <textarea id="actividadEconomica" rows="3" placeholder="Máx 200 caracteres" maxlength="200" oninput="updateCounter('actividadEconomica', 200)"></textarea>
                        <div class="character-counter" id="actividadEconomicaCounter">0/200 caracteres</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Centros de Costos</label>
                    <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                        <input type="text" id="centroCostoInput" placeholder="Número de 5 dígitos" maxlength="5" style="flex: 1;" />
                        <button type="button" class="btn btn-secondary btn-small" onclick="addCentroCosto()">Agregar</button>
                    </div>
                    <table id="centrosCostosTable" style="display:none;">
                        <thead><tr><th>Centro de Costo</th><th>Acciones</th></tr></thead>
                        <tbody id="centrosCostosBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Sección 2: Ubicación -->
            <div class="section">
                <h2 class="section-title"><span class="material-icons">location_on</span> Ubicación</h2>

                <div class="form-row">
                    <div class="form-group">
                        <label for="pais" class="required">País</label>
                        <select id="pais" required onchange="handlePaisChange()">
                            <option value="">Seleccione...</option>
                            <option value="1">Colombia</option>
                            <option value="2">Argentina</option>
                            <option value="12">Estados Unidos</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="departamento" id="departamentoLabel">Departamento</label>
                        <select id="departamento" disabled onchange="handleDepartamentoChange()">
                            <option value="">Seleccione...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ciudad" id="ciudadLabel">Ciudad</label>
                        <select id="ciudad" disabled>
                            <option value="">Seleccione...</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" style="grid-column: 1/-1;">
                        <label for="direccionPrincipal" class="required">Dirección Principal</label>
                        <input type="text" id="direccionPrincipal" placeholder="Calle 100 # 20-30, Oficina 502" required />
                    </div>
                </div>
            </div>

            <!-- Sección 3: Registro Mercantil -->
            <div class="section">
                <h2 class="section-title"><span class="material-icons">description</span> Registro Mercantil</h2>

                <div class="form-row">
                    <div class="form-group">
                        <label for="matriculaMercantil" class="required">Matrícula Mercantil</label>
                        <input type="text" id="matriculaMercantil" placeholder="5-15 caracteres" maxlength="15" />
                    </div>
                    <div class="form-group">
                        <label for="nombreRegistro" class="required">Nombre en Registro</label>
                        <input type="text" id="nombreRegistro" placeholder="Nombre completo" />
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="paisRegistro" class="required">País</label>
                        <select id="paisRegistro" onchange="handlePaisRegistroChange()">
                            <option value="">Seleccione...</option>
                            <option value="1">Colombia</option>
                            <option value="2">Argentina</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="departamentoRegistro">Departamento</label>
                        <select id="departamentoRegistro" disabled onchange="handleDepartamentoRegistroChange()">
                            <option value="">Seleccione...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ciudadRegistro">Ciudad</label>
                        <select id="ciudadRegistro" disabled>
                            <option value="">Seleccione...</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" style="grid-column: 1/-1;">
                        <label for="direccionRegistro" class="required">Dirección</label>
                        <input type="text" id="direccionRegistro" placeholder="Dirección completa" />
                    </div>
                </div>

                <button type="button" class="btn btn-secondary btn-small" onclick="addRegistroMercantil()">
                    <span class="material-icons" style="font-size: 16px;">add</span> Agregar Registro Mercantil
                </button>

                <table id="registrosMercantilesTable" style="display:none; margin-top: 16px;">
                    <thead><tr><th>Matrícula</th><th>Nombre</th><th>País</th><th>Dirección</th><th>Acciones</th></tr></thead>
                    <tbody id="registrosMercantilesBody"></tbody>
                </table>
            </div>

            <div class="button-group">
                <button type="button" class="btn btn-secondary" onclick="handleCancel()">Cancelar</button>
                <button type="submit" class="btn btn-primary" id="submitBtn" disabled>Crear Empresa</button>
            </div>
        </form>
    </div>

    <script>
        // Datos mock
        const departamentos = {
            '1': [{code: '14', name: 'Cundinamarca'}, {code: '2', name: 'Antioquia'}]
        };
        const ciudades = {
            '14': [{code: '1', name: 'Bogotá D.C.'}],
            '2': [{code: '1', name: 'Medellín'}]
        };
        const centrosCostos = [];
        const registrosMercantiles = [];

        // Algoritmo DV DIAN
        function calcularDV(nit) {
            const multiplicadores = [3, 7, 13, 17, 19, 23, 29, 37, 41, 43, 47, 53, 59, 67, 71];
            const nitArray = nit.split('').reverse();
            let suma = 0;
            for (let i = 0; i < nitArray.length; i++) {
                suma += parseInt(nitArray[i]) * multiplicadores[i];
            }
            const residuo = suma % 11;
            return residuo > 1 ? 11 - residuo : residuo;
        }

        function validateDV() {
            const numeroId = document.getElementById('numeroId').value;
            const dv = document.getElementById('dv').value;
            const helper = document.getElementById('dvHelper');

            if (!numeroId || !dv) return;

            const dvCorrecto = calcularDV(numeroId);
            if (parseInt(dv) === dvCorrecto) {
                document.getElementById('dv').classList.remove('error');
                document.getElementById('dv').classList.add('success');
                helper.className = 'helper-text success';
                helper.innerHTML = '<span class="material-icons" style="font-size:16px;">check_circle</span> DV correcto';
            } else {
                document.getElementById('dv').classList.add('error');
                document.getElementById('dv').classList.remove('success');
                helper.className = 'helper-text error';
                helper.textContent = `DV incorrecto. El DV correcto es: ${dvCorrecto}`;
            }
        }

        function validateNumeroId() {
            const input = document.getElementById('numeroId');
            input.value = input.value.replace(/\D/g, '');
        }

        function checkUniqueness() {
            const numeroId = document.getElementById('numeroId').value;
            const helper = document.getElementById('numeroIdHelper');

            if (!numeroId) return;

            // Simulación de validación
            if (numeroId === '900123456') {
                document.getElementById('numeroId').classList.add('error');
                helper.className = 'helper-text error';
                helper.textContent = 'Este número de identificación ya existe en el sistema.';
            } else {
                document.getElementById('numeroId').classList.remove('error');
                document.getElementById('numeroId').classList.add('success');
                helper.className = 'helper-text success';
                helper.innerHTML = '<span class="material-icons" style="font-size:16px;">check_circle</span> NIT disponible';
            }
        }

        function validateEmail() {
            const input = document.getElementById('correoEmisor');
            const helper = document.getElementById('correoHelper');
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if (!input.value) return;

            if (regex.test(input.value)) {
                input.classList.remove('error');
                input.classList.add('success');
                helper.className = 'helper-text success';
                helper.innerHTML = '<span class="material-icons" style="font-size:16px;">check_circle</span> Email válido';
            } else {
                input.classList.add('error');
                helper.className = 'helper-text error';
                helper.textContent = 'Ingrese un correo electrónico válido';
            }
        }

        function handleTipoIdChange() {
            const tipoId = document.getElementById('tipoId').value;
            const esNIT = tipoId === '31';

            document.getElementById('razonSocialGroup').style.display = esNIT ? 'flex' : 'none';
            document.getElementById('razonSocial').disabled = !esNIT;

            document.getElementById('nombresGroup').style.display = !esNIT ? 'flex' : 'none';
            document.getElementById('nombres').disabled = esNIT;

            document.getElementById('apellidosGroup').style.display = !esNIT ? 'flex' : 'none';
            document.getElementById('apellidos').disabled = esNIT;
        }

        function handlePaisChange() {
            const pais = document.getElementById('pais').value;
            const esColombia = pais === '1';

            const deptoSelect = document.getElementById('departamento');
            const ciudadSelect = document.getElementById('ciudad');

            if (esColombia) {
                deptoSelect.disabled = false;
                deptoSelect.innerHTML = '<option value="">Seleccione...</option>';
                departamentos[pais].forEach(d => {
                    deptoSelect.innerHTML += `<option value="${d.code}">${d.name}</option>`;
                });
                document.getElementById('departamentoLabel').classList.add('required');
                document.getElementById('ciudadLabel').classList.add('required');
            } else {
                deptoSelect.disabled = true;
                ciudadSelect.disabled = true;
                deptoSelect.innerHTML = '<option value="">Seleccione...</option>';
                ciudadSelect.innerHTML = '<option value="">Seleccione...</option>';
                document.getElementById('departamentoLabel').classList.remove('required');
                document.getElementById('ciudadLabel').classList.remove('required');
            }
        }

        function handleDepartamentoChange() {
            const depto = document.getElementById('departamento').value;
            const ciudadSelect = document.getElementById('ciudad');

            if (depto && ciudades[depto]) {
                ciudadSelect.disabled = false;
                ciudadSelect.innerHTML = '<option value="">Seleccione...</option>';
                ciudades[depto].forEach(c => {
                    ciudadSelect.innerHTML += `<option value="${c.code}">${c.name}</option>`;
                });
            } else {
                ciudadSelect.disabled = true;
                ciudadSelect.innerHTML = '<option value="">Seleccione...</option>';
            }
        }

        function handlePaisRegistroChange() {
            const pais = document.getElementById('paisRegistro').value;
            const esColombia = pais === '1';
            const deptoSelect = document.getElementById('departamentoRegistro');

            if (esColombia) {
                deptoSelect.disabled = false;
                deptoSelect.innerHTML = '<option value="">Seleccione...</option>';
                departamentos[pais].forEach(d => {
                    deptoSelect.innerHTML += `<option value="${d.code}">${d.name}</option>`;
                });
            } else {
                deptoSelect.disabled = true;
                deptoSelect.innerHTML = '<option value="">Seleccione...</option>';
            }
        }

        function handleDepartamentoRegistroChange() {
            const depto = document.getElementById('departamentoRegistro').value;
            const ciudadSelect = document.getElementById('ciudadRegistro');

            if (depto && ciudades[depto]) {
                ciudadSelect.disabled = false;
                ciudadSelect.innerHTML = '<option value="">Seleccione...</option>';
                ciudades[depto].forEach(c => {
                    ciudadSelect.innerHTML += `<option value="${c.code}">${c.name}</option>`;
                });
            } else {
                ciudadSelect.disabled = true;
            }
        }

        function updateCounter(fieldId, max) {
            const field = document.getElementById(fieldId);
            const counter = document.getElementById(fieldId + 'Counter');
            counter.textContent = `${field.value.length}/${max} caracteres`;
        }

        function addCentroCosto() {
            const input = document.getElementById('centroCostoInput');
            const value = input.value.trim();

            if (!/^\d{1,5}$/.test(value)) {
                alert('Ingrese un valor numérico de hasta 5 dígitos');
                return;
            }

            centrosCostos.push(value);
            const table = document.getElementById('centrosCostosTable');
            const tbody = document.getElementById('centrosCostosBody');

            tbody.innerHTML += `<tr><td>${value}</td><td><button type="button" class="icon-btn" onclick="removeCentroCosto(${centrosCostos.length-1})"><span class="material-icons">delete</span></button></td></tr>`;
            table.style.display = 'table';
            input.value = '';
        }

        function removeCentroCosto(index) {
            if (confirm(`¿Eliminar Centro de Costos ${centrosCostos[index]}?`)) {
                centrosCostos.splice(index, 1);
                refreshCentrosCostosTable();
            }
        }

        function refreshCentrosCostosTable() {
            const tbody = document.getElementById('centrosCostosBody');
            tbody.innerHTML = '';
            centrosCostos.forEach((cc, i) => {
                tbody.innerHTML += `<tr><td>${cc}</td><td><button type="button" class="icon-btn" onclick="removeCentroCosto(${i})"><span class="material-icons">delete</span></button></td></tr>`;
            });
        }

        function addRegistroMercantil() {
            const matricula = document.getElementById('matriculaMercantil').value;
            const nombre = document.getElementById('nombreRegistro').value;
            const pais = document.getElementById('paisRegistro').options[document.getElementById('paisRegistro').selectedIndex].text;
            const direccion = document.getElementById('direccionRegistro').value;

            if (!matricula || !nombre || !pais || !direccion) {
                alert('Complete todos los campos obligatorios del Registro Mercantil');
                return;
            }

            registrosMercantiles.push({matricula, nombre, pais, direccion});
            const table = document.getElementById('registrosMercantilesTable');
            const tbody = document.getElementById('registrosMercantilesBody');

            tbody.innerHTML += `<tr><td>${matricula}</td><td>${nombre}</td><td>${pais}</td><td>${direccion}</td><td><button type="button" class="icon-btn" onclick="removeRegistro(${registrosMercantiles.length-1})"><span class="material-icons">delete</span></button></td></tr>`;
            table.style.display = 'table';

            // Limpiar formulario
            document.getElementById('matriculaMercantil').value = '';
            document.getElementById('nombreRegistro').value = '';
            document.getElementById('paisRegistro').value = '';
            document.getElementById('direccionRegistro').value = '';
        }

        function removeRegistro(index) {
            if (confirm(`¿Eliminar Registro Mercantil ${registrosMercantiles[index].matricula}?`)) {
                registrosMercantiles.splice(index, 1);
                refreshRegistrosTable();
            }
        }

        function refreshRegistrosTable() {
            const tbody = document.getElementById('registrosMercantilesBody');
            tbody.innerHTML = '';
            registrosMercantiles.forEach((r, i) => {
                tbody.innerHTML += `<tr><td>${r.matricula}</td><td>${r.nombre}</td><td>${r.pais}</td><td>${r.direccion}</td><td><button type="button" class="icon-btn" onclick="removeRegistro(${i})"><span class="material-icons">delete</span></button></td></tr>`;
            });
        }

        function handleCancel() {
            if (confirm('¿Está seguro que desea cancelar? Se perderán todos los datos ingresados.')) {
                alert('Cancelando...');
            }
        }

        document.getElementById('empresaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Esta es una demostración. En producción, mostraría la pantalla de resumen.');
        });

        // Habilitar botón submit cuando campos obligatorios estén completos
        setInterval(() => {
            const numeroId = document.getElementById('numeroId').value;
            const tipoId = document.getElementById('tipoId').value;
            document.getElementById('submitBtn').disabled = !numeroId || !tipoId;
        }, 500);
    </script>
</body>
</html>
