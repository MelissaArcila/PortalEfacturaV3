<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HU002 - Restablecer Contraseña - Portal Unificado Efactura</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #4A5A9E 0%, #D4145A 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 560px;
            padding: 48px 40px;
        }

        .logo-section {
            text-align: center;
            margin-bottom: 32px;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #4A5A9E 0%, #D4145A 100%);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: white;
            font-weight: bold;
        }

        h3 {
            font-size: 24px;
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 12px;
        }

        .subtitle {
            font-size: 14px;
            color: #616161;
            line-height: 1.6;
            margin-bottom: 32px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #424242;
            margin-bottom: 8px;
        }

        .input-wrapper {
            position: relative;
        }

        .text-field {
            width: 100%;
            padding: 14px 48px 14px 16px;
            font-size: 16px;
            border: 1px solid #bdbdbd;
            border-radius: 4px;
            transition: all 0.2s;
            font-family: 'Roboto', sans-serif;
            outline: none;
        }

        .text-field:hover {
            border-color: #757575;
        }

        .text-field:focus {
            border-color: #4A5A9E;
            border-width: 2px;
            padding: 13px 47px 13px 15px;
        }

        .text-field.error {
            border-color: #d32f2f;
        }

        .toggle-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #757575;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }

        .toggle-password:hover {
            color: #4A5A9E;
        }

        .password-requirements {
            margin-top: 12px;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 4px;
            font-size: 13px;
        }

        .requirement {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
            color: #616161;
            transition: color 0.2s;
        }

        .requirement.met {
            color: #2e7d32;
        }

        .requirement.not-met {
            color: #d32f2f;
        }

        .requirement-icon {
            font-size: 16px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .strength-bar-container {
            margin-top: 12px;
        }

        .strength-label {
            font-size: 12px;
            color: #616161;
            margin-bottom: 4px;
        }

        .strength-bar {
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
        }

        .strength-bar-fill {
            height: 100%;
            width: 0%;
            transition: all 0.3s;
            border-radius: 3px;
        }

        .strength-weak {
            width: 33%;
            background: #f44336;
        }

        .strength-medium {
            width: 66%;
            background: #ff9800;
        }

        .strength-strong {
            width: 100%;
            background: #4caf50;
        }

        .helper-text {
            font-size: 12px;
            margin-top: 6px;
            display: none;
        }

        .helper-text.error {
            color: #d32f2f;
            display: block;
        }

        .alert {
            padding: 14px 16px;
            border-radius: 4px;
            margin-bottom: 24px;
            display: none;
            font-size: 14px;
            align-items: center;
            gap: 12px;
        }

        .alert.show {
            display: flex;
        }

        .alert.success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .alert-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .btn {
            flex: 1;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 500;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Roboto', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4A5A9E 0%, #D4145A 100%);
            color: white;
            border: none;
        }

        .btn-primary:hover:not(:disabled) {
            box-shadow: 0 4px 12px rgba(74, 90, 158, 0.4);
            transform: translateY(-1px);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: white;
            color: #4A5A9E;
            border: 1px solid #4A5A9E;
        }

        .btn-secondary:hover {
            background: #f5f5f5;
        }

        /* Demo selector */
        .demo-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            max-width: 250px;
        }

        .demo-selector h4 {
            font-size: 14px;
            margin-bottom: 12px;
            color: #2c3e50;
            font-weight: 500;
        }

        .demo-selector button {
            display: block;
            width: 100%;
            padding: 8px 12px;
            margin-bottom: 8px;
            font-size: 13px;
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .demo-selector button:hover {
            background: #e0e0e0;
        }

        .demo-selector button.active {
            background: #4A5A9E;
            color: white;
            border-color: #4A5A9E;
        }

        @media (max-width: 600px) {
            .container {
                padding: 32px 24px;
            }

            .demo-selector {
                position: static;
                margin-bottom: 20px;
                max-width: 100%;
            }

            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Demo selector -->
    <div class="demo-selector">
        <h4>Estados del Mockup</h4>
        <button onclick="setState('normal', this)" class="active">Estado Normal</button>
        <button onclick="setState('typing-weak', this)">Contraseña Débil</button>
        <button onclick="setState('typing-medium', this)">Contraseña Media</button>
        <button onclick="setState('typing-strong', this)">Contraseña Fuerte</button>
        <button onclick="setState('mismatch', this)">Contraseñas No Coinciden</button>
        <button onclick="setState('success', this)">Cambio Exitoso</button>
    </div>

    <div class="container">
        <div class="logo-section">
            <div class="logo">E</div>
            <h3>Restablecer contraseña</h3>
            <p class="subtitle">Ingresa tu nueva contraseña. Debe cumplir con los requisitos de seguridad.</p>
        </div>

        <div class="alert success" id="successAlert">
            <span class="alert-icon">✓</span>
            <span>Tu contraseña ha sido actualizada correctamente. Redirigiendo a inicio de sesión...</span>
        </div>

        <form id="resetPasswordForm">
            <div class="form-group">
                <label for="newPassword">Nueva contraseña</label>
                <div class="input-wrapper">
                    <input
                        type="password"
                        id="newPassword"
                        class="text-field"
                        placeholder="Ingresa tu nueva contraseña"
                        autocomplete="new-password"
                    >
                    <button type="button" class="toggle-password" onclick="togglePassword('newPassword', this)">
                        <span class="material-icons">visibility</span>
                    </button>
                </div>

                <div class="password-requirements" id="requirements">
                    <div class="requirement" data-req="length">
                        <span class="requirement-icon">✗</span>
                        <span>Mínimo 8 caracteres</span>
                    </div>
                    <div class="requirement" data-req="uppercase">
                        <span class="requirement-icon">✗</span>
                        <span>Al menos una mayúscula (A-Z)</span>
                    </div>
                    <div class="requirement" data-req="lowercase">
                        <span class="requirement-icon">✗</span>
                        <span>Al menos una minúscula (a-z)</span>
                    </div>
                    <div class="requirement" data-req="number">
                        <span class="requirement-icon">✗</span>
                        <span>Al menos un número (0-9)</span>
                    </div>
                    <div class="requirement" data-req="symbol">
                        <span class="requirement-icon">✗</span>
                        <span>Al menos un símbolo (!@#$%^&*)</span>
                    </div>
                    <div class="requirement" data-req="not-current">
                        <span class="requirement-icon">✗</span>
                        <span>No puede ser igual a contraseña actual</span>
                    </div>
                    <div class="requirement" data-req="not-recent">
                        <span class="requirement-icon">✗</span>
                        <span>No puede ser una de las últimas 5 contraseñas</span>
                    </div>
                </div>

                <div class="strength-bar-container">
                    <div class="strength-label" id="strengthLabel">Fortaleza: -</div>
                    <div class="strength-bar">
                        <div class="strength-bar-fill" id="strengthBarFill"></div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="confirmPassword">Confirmar contraseña</label>
                <div class="input-wrapper">
                    <input
                        type="password"
                        id="confirmPassword"
                        class="text-field"
                        placeholder="Confirma tu nueva contraseña"
                        autocomplete="new-password"
                    >
                    <button type="button" class="toggle-password" onclick="togglePassword('confirmPassword', this)">
                        <span class="material-icons">visibility</span>
                    </button>
                </div>
                <div class="helper-text" id="confirmHelper">
                    Las contraseñas no coinciden
                </div>
            </div>

            <div class="button-group">
                <button type="button" class="btn btn-secondary" onclick="handleCancel()">
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary" id="submitBtn" disabled>
                    Restablecer Contraseña
                </button>
            </div>
        </form>
    </div>

    <script>
        const newPasswordInput = document.getElementById('newPassword');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const submitBtn = document.getElementById('submitBtn');
        const confirmHelper = document.getElementById('confirmHelper');
        const successAlert = document.getElementById('successAlert');
        const strengthLabel = document.getElementById('strengthLabel');
        const strengthBarFill = document.getElementById('strengthBarFill');
        const form = document.getElementById('resetPasswordForm');

        // Simulación de contraseñas previas para validación
        const previousPasswords = ['OldPass123!', 'Previous1@', 'MyPass456#'];

        // Requisitos de contraseña
        const requirements = {
            length: (pwd) => pwd.length >= 8,
            uppercase: (pwd) => /[A-Z]/.test(pwd),
            lowercase: (pwd) => /[a-z]/.test(pwd),
            number: (pwd) => /[0-9]/.test(pwd),
            symbol: (pwd) => /[!@#$%^&*]/.test(pwd),
            'not-current': (pwd) => pwd !== 'CurrentPass123!', // Simulación
            'not-recent': (pwd) => !previousPasswords.includes(pwd)
        };

        // Calcular fortaleza de contraseña
        function calculateStrength(password) {
            let score = 0;
            if (password.length >= 8) score++;
            if (password.length >= 12) score++;
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) score++;
            if (/[0-9]/.test(password)) score++;
            if (/[!@#$%^&*]/.test(password)) score++;

            if (score <= 2) return 'weak';
            if (score <= 4) return 'medium';
            return 'strong';
        }

        // Actualizar indicadores de requisitos
        function updateRequirements(password) {
            let allMet = true;

            Object.keys(requirements).forEach(req => {
                const element = document.querySelector(`[data-req="${req}"]`);
                const isMet = requirements[req](password);

                if (isMet) {
                    element.classList.add('met');
                    element.classList.remove('not-met');
                    element.querySelector('.requirement-icon').textContent = '✓';
                } else {
                    element.classList.add('not-met');
                    element.classList.remove('met');
                    element.querySelector('.requirement-icon').textContent = '✗';
                    allMet = false;
                }
            });

            return allMet;
        }

        // Actualizar barra de fortaleza
        function updateStrengthBar(password) {
            if (password.length === 0) {
                strengthBarFill.className = 'strength-bar-fill';
                strengthLabel.textContent = 'Fortaleza: -';
                return;
            }

            const strength = calculateStrength(password);
            strengthBarFill.className = 'strength-bar-fill strength-' + strength;

            const labels = {
                weak: 'Débil',
                medium: 'Media',
                strong: 'Fuerte'
            };
            strengthLabel.textContent = 'Fortaleza: ' + labels[strength];
        }

        // Validar formulario completo
        function validateForm() {
            const newPassword = newPasswordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            const requirementsMet = updateRequirements(newPassword);
            const passwordsMatch = newPassword === confirmPassword && newPassword.length > 0;

            if (confirmPassword.length > 0 && !passwordsMatch) {
                confirmPasswordInput.classList.add('error');
                confirmHelper.classList.add('error');
            } else {
                confirmPasswordInput.classList.remove('error');
                confirmHelper.classList.remove('error');
            }

            submitBtn.disabled = !(requirementsMet && passwordsMatch);
        }

        // Event listeners
        newPasswordInput.addEventListener('input', function() {
            updateStrengthBar(this.value);
            validateForm();
        });

        confirmPasswordInput.addEventListener('input', validateForm);

        // Alternar visibilidad de contraseña
        function togglePassword(inputId, buttonElement) {
            const input = document.getElementById(inputId);
            const icon = buttonElement.querySelector('.material-icons');

            if (input.type === 'password') {
                input.type = 'text';
                icon.textContent = 'visibility_off';
            } else {
                input.type = 'password';
                icon.textContent = 'visibility';
            }
        }

        // Envío del formulario
        form.addEventListener('submit', function(e) {
            e.preventDefault();

            if (!submitBtn.disabled) {
                successAlert.classList.add('show');
                form.style.display = 'none';

                // Simular redirección después de 3 segundos
                setTimeout(() => {
                    alert('Redirigiendo a inicio de sesión...');
                }, 3000);
            }
        });

        // Cancelar
        function handleCancel() {
            if (confirm('¿Estás seguro de que deseas cancelar? Los cambios no se guardarán.')) {
                alert('Esta es una demostración. En producción, redirigirá a inicio de sesión.');
            }
        }

        // Cambiar estados del demo
        function setState(state, buttonElement) {
            // Actualizar botones activos
            document.querySelectorAll('.demo-selector button').forEach(btn => {
                btn.classList.remove('active');
            });
            buttonElement.classList.add('active');

            // Resetear estado
            successAlert.classList.remove('show');
            form.style.display = 'block';
            newPasswordInput.value = '';
            confirmPasswordInput.value = '';
            newPasswordInput.classList.remove('error');
            confirmPasswordInput.classList.remove('error');
            confirmHelper.classList.remove('error');
            strengthBarFill.className = 'strength-bar-fill';
            strengthLabel.textContent = 'Fortaleza: -';
            submitBtn.disabled = true;

            // Resetear requisitos
            document.querySelectorAll('.requirement').forEach(req => {
                req.classList.remove('met', 'not-met');
                req.querySelector('.requirement-icon').textContent = '✗';
            });

            // Aplicar estado
            switch(state) {
                case 'typing-weak':
                    newPasswordInput.value = 'pass123';
                    updateStrengthBar(newPasswordInput.value);
                    updateRequirements(newPasswordInput.value);
                    break;

                case 'typing-medium':
                    newPasswordInput.value = 'Password123';
                    updateStrengthBar(newPasswordInput.value);
                    updateRequirements(newPasswordInput.value);
                    break;

                case 'typing-strong':
                    newPasswordInput.value = 'MySecure@Pass123';
                    confirmPasswordInput.value = 'MySecure@Pass123';
                    updateStrengthBar(newPasswordInput.value);
                    validateForm();
                    break;

                case 'mismatch':
                    newPasswordInput.value = 'MySecure@Pass123';
                    confirmPasswordInput.value = 'Different123!';
                    updateStrengthBar(newPasswordInput.value);
                    validateForm();
                    break;

                case 'success':
                    successAlert.classList.add('show');
                    form.style.display = 'none';
                    break;

                case 'normal':
                default:
                    // Estado normal, sin cambios adicionales
                    break;
            }
        }
    </script>
</body>
</html>
